---

target_os: debian #proxmox
hostname_morpheus: morpheus
hostname_cartman: "{{ hostname_morpheus }}" #todo fix
main_username: alex

# grog.package
package_list:
  - name: bash-completion
  - name: curl
  - name: dnsutils
  - name: fio
  - name: git
  - name: hddtemp
  - name: htop
  - name: ffmpeg
  - name: iftop
  - name: intel-gpu-tools
  - name: iotop
  - name: ipmitool
  - name: lm-sensors
  - name: mc
  - name: mergerfs
  - name: mutt
  - name: ncdu
  - name: net-tools
  - name: nut
  - name: nut-client
  - name: nut-server
  - name: nfs-kernel-server
  - name: nmap
  - name: nvme-cli
  - name: openssh-server
  #- name: open-vm-tools #vmware
  - name: python3
  - name: python-setuptools
  #- name: qemu-guest-agent
  #- name: sanoid
  - name: screen
  #- name: ssh-import-id
  - name: smartmontools
  - name: sudo
  - name: tmux
  - name: tree
  - name: wget
  #- name: wireguard-tools
  - name: xfsprogs
  - name: zfsutils-linux

## snapraid
snapraid_config_excludes:
  - "*.unrecoverable"
  - "/tmp/"
  - "/lost+found/"
  - "downloads/"
  - "appdata/"
  - "*.!sync"
  - ".AppleDouble"
  - "._AppleDouble"
  - ".DS_Store"
  - "._.DS_Store"
  - ".Thumbs.db"
  - ".fseventsd"
  - ".Spotlight-V100"
  - ".TemporaryItems"
  - ".Trashes"
  - ".AppleDB"

## telegraf
telegraf_plugins_base:
  - name: mem
  - name: system
  - name: cpu
    options:
      percpu: "true"
      totalcpu: "true"
      collect_cpu_time: "false"
      report_active: "false"
  - name: disk
    options:
      ignore_fs:
        - "tmpfs"
        - "devtmpfs"
        - "devfs"
      mountpoints:
        - "/"
        - "/mnt/disk1"
        - "/mnt/disk2"
        - "/mnt/disk3"
        - "/mnt/disk4"
        - "/mnt/disk5"
        - "/mnt/disk6"
        - "/mnt/disk7"
        - "/mnt/disk8"
        - "/mnt/disk9"
        - "/mnt/parity1"
        - "/mnt/parity2"
        - "/mnt/storage"
        - "/mnt/tank"
  - name: diskio
    options:
      skip_serial_number: "true"
  - name: kernel
  - name: processes
  - name: docker
    options:
      endpoint: "unix:///var/run/docker.sock"
      perdevice: "true"
  - name: hddtemp
  - name: net
    options:
      interfaces:
        - "ens192"

# ktz-sanoid
sanoid_build_from_source: true
sanoid_config_source: sanoid-morpheus.conf
syncoid_cloud_dataset: "demo:tank/appdata"
syncoid_hc_url: "curl -fsS -m 10 --retry 5 -o /dev/null https://hc.{{ domain_cloud }}/ping"
syncoid_cron_jobs:
  ## cloud to morpheus
  - { job: '{{ syncoid_hc_url }}/{{ syncoid_hc_uuid_cloud }}/start && {{ syncoid_binary_path }} -r --skip-parent {{ syncoid_cloud_dataset }} tank/backups/cloud | {{ syncoid_hc_url }}/{{ syncoid_hc_uuid_cloud }} --data-binary "@-"', name: 'cloud_replication', weekday: '*', hour: '*/6' }

  ## morpheus to pennywise data
  - { job: '{{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_audiobooks }}/start && {{ syncoid_binary_path }} --source-bwlimit=1M tank/fuse/audiobooks p:z2/morpheus/tank/fuse/audiobooks | {{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_audiobooks }} --data-binary "@-"', name: 'morpheus to pennywise audiobooks', weekday: '*', hour: '1' }
  - { job: '{{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_documents }}/start && {{ syncoid_binary_path }} --source-bwlimit=1M tank/fuse/documents p:z2/morpheus/tank/fuse/documents | {{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_documents }} --data-binary "@-"', name: 'morpheus to pennywise documents', weekday: '*', hour: '3' }
  - { job: '{{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_drone }}/start && {{ syncoid_binary_path }} --source-bwlimit=1M tank/fuse/drone p:z2/morpheus/tank/fuse/drone | {{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_drone }} --data-binary "@-"', name: 'morpheus to pennywise drone', weekday: '*', hour: '4',  }
  #- { job: '{{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_music }}/start && {{ syncoid_binary_path }} --source-bwlimit=1M tank/fuse/music p:z2/morpheus/tank/fuse/music | {{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_music }} --data-binary "@-"', name: 'morpheus to pennywise music', weekday: '*', hour: '5' }
  - { job: '{{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_photos }}/start && {{ syncoid_binary_path }} --source-bwlimit=1M tank/fuse/photos p:z2/morpheus/tank/fuse/photos | {{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_photos }} --data-binary "@-"', name: 'morpheus to pennywise photos', weekday: '*', hour: '6' }
  - { job: '{{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_podcast }}/start && {{ syncoid_binary_path }} --source-bwlimit=1M tank/fuse/podcast p:z2/morpheus/tank/fuse/podcast | {{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_podcast }} --data-binary "@-"', name: 'morpheus to pennywise podcast', weekday: '*', hour: '7' }
  - { job: '{{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_software }}/start && {{ syncoid_binary_path }} --source-bwlimit=1M tank/fuse/software p:z2/morpheus/tank/fuse/software | {{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_software }} --data-binary "@-"', name: 'morpheus to pennywise software', weekday: '*', hour: '8' }
  - { job: '{{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_sports }}/start && {{ syncoid_binary_path }} --source-bwlimit=1M tank/fuse/sports p:z2/morpheus/tank/fuse/sports | {{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_sports }} --data-binary "@-"', name: 'morpheus to pennywise sports', weekday: '*', hour: '9' }
  - { job: '{{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_videos }}/start && {{ syncoid_binary_path }} --source-bwlimit=1M tank/fuse/videos p:z2/morpheus/tank/fuse/videos | {{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_videos }} --data-binary "@-"', name: 'morpheus to pennywise videos', weekday: '*', hour: '10' }

  ## morpheus to pennywise docker appdata
  - { job: '{{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_appdata }}/start && {{ syncoid_binary_path }} -r --skip-parent --exclude influxdb --source-bwlimit=2M nvme2tb/appdata p:z2/morpheus/backups/appdata | {{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_appdata }} --data-binary "@-"', name: 'morpheus to pennywise appdata', weekday: '*', hour: '11' }
  - { job: '{{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_backups }}/start && {{ syncoid_binary_path }} -r --source-bwlimit=2M --no-sync-snap tank/backups p:z2/morpheus/tank/backups | {{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_pen_backups }} --data-binary "@-"', name: 'morpheus to pennywise backups', weekday: '*', hour: '12' }

  ## morpheus local jobs
  - { job: '{{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_plexmeta }}/start && /usr/bin/docker run --name plexmetamanager --rm -v /mnt/nvme2tb/appdata/plexmeta/config:/config meisnate12/plex-meta-manager --run | {{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_plexmeta }} --data-binary "@-"', name: 'plexmeta', weekday: '*/1' }
  - { job: 'docker restart plextraktsync', name: 'plextraktsync', weekday: '*12' }

  ## morpheus to elrond jobs
  - { job: '{{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_elr_autorestic }}/start && /usr/local/bin/autorestic backup -av -c /root/.autorestic.yml | {{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_elr_autorestic  }} --data-binary "@-"', name: 'morpheus to elrond - autorestic', weekday: '*', hour: '13' }


# ironicbadger.snapraid
snapraid_bin_path: /usr/local/bin/snapraid
snapraid_runner_cron_jobs:
  - { job: '{{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_snapraid }}/start && {{ snapraid_runner_command }} | {{ syncoid_hc_url }}/{{ syncoid_hc_uuid_mor_snapraid }} --data-binary "@-"', name: 'snapraid_runner', weekday: '*', hour: '01' }

# ktz-autorestic
simple_autorestic_decrypt: true

autorestic_locations:
  - name: audiobooks
    from: /mnt/tank/fuse/audiobooks
    to: 
      - morpheus-audiobooks
autorestic_backends:
  - name: "{{ elrond_minio_bucket_audiobooks | selectattr('name', 'defined') | map(attribute='name') }}"
    type: s3
    path: "https://minio.el.gg.{{ domain_me }}/morpheus-audiobooks"
    key: some-random-password-198rc79r8y1029c8yfewj8f1u0ef87yh198uoieufy
    env:
      - "AWS_ACCESS_KEY_ID: elrondkey"
      - "AWS_SECRET_ACCESS_KEY: elrondkey"


      #docker_users: "{{ users|selectattr('docker', 'defined')|map(attribute='username') }}"


# ironicbadger.bash-aliases (formerly ferrarimarco.bash-aliases)
bash_aliases:
  - { alias: "dtail", command: "docker logs -tf --tail='50' " }
  - { alias: "dstop", command: "docker stop `docker ps -aq`" }
  - { alias: "drm", command: "docker rm `docker ps -aq`" }
  - { alias: "dcp", command: "docker-compose -f ~/docker-compose.yml "}
  - { alias: "dcporph", command: "docker-compose -f ~/docker-compose.yml up -d --remove-orphans"}
  - { alias: "dprune", command: "docker image prune" }
  - { alias: "dprunesys", command: "docker system prune --all" }
  - { alias: "dtop", command: "docker run --name ctop  -it --rm -v /var/run/docker.sock:/var/run/docker.sock quay.io/vektorlab/ctop"}
  - { alias: "appdata", command: "cd /mnt/nvme2tb/appdata" }
  - { alias: "zspace", command: "zfs list -o space" }
  - { alias: "zsnap", command: "zfs list -t snapshot" }
  - { alias: "dfclean", command: "df -h -x tmpfs -t fuse.mergerfs -t xfs -t ext4"}
  - { alias: "dffull", command: "df -h -x tmpfs -t fuse.mergerfs -t xfs -t ext4 -t zfs"}
  - { alias: "hdtemp", command: "sudo hddtemp /dev/sd[a,b,c,d,e,f,g,h,i,j,k,l,m,n]"}
  - { alias: "nvmetemp", command: "for i in {0..3}; do nvme smart-log /dev/nvme'$i'n1 | grep temperature; done;"}

# ktz-cartman
docker_zfs_override: true
morpheus_main_storage_path: /mnt/storage
extra_mountpoints:
  - { path: "{{ morpheus_main_storage_path }}" }
  #- { path: /opt, diskbyid: "UUID=cbf30089-2d57-4e83-ad62-763992d0f57a", fs: ext4, opts: "defaults,discard" }
  #- { path: /opt/appdata, diskbyid: "UUID=06c5ccf6-6fd8-4f2a-8213-81107f034c4e", fs: ext4, opts: "defaults,discard" }

# ironicbadger.snapraid
snapraid_runner: true
snapraid_parity_disks:
  # parity upgraded nov 11th 2021 - 12tb to 14tb. 12tb moved to disk6
  #- { path: /mnt/parity1, diskbyid: /dev/disk/by-id/ata-WDC_WD120EDAZ-11F3RA0_5PJHZW1F-part1, fs: ext4, opts: defaults, content: false }
  - { path: /mnt/parity1, diskbyid: /dev/disk/by-id/ata-WDC_WD140EDGZ-11B1PA0_Y6GX1KWC-part1, fs: ext4, opts: defaults, content: false }

snapraid_data_disks:
  - { path: /mnt/disk1, diskbyid: /dev/disk/by-id/ata-WDC_WD120EDAZ-11F3RA0_5PJJ0K4F-part1, fs: xfs, opts: defaults, content: true }
  # disk2 replaced nov 11th 2021 - 8tb to 14tb
  #- { path: /mnt/disk2, diskbyid: /dev/disk/by-id/ata-HGST_HDN728080ALE604_R6GPPDTY-part1, fs: ext4, opts: defaults, content: true }
  - { path: /mnt/disk2, diskbyid: /dev/disk/by-id/ata-WDC_WD140EDGZ-11B1PA0_Y6GE3JJC-part1, fs: xfs, opts: defaults, content: true }
  - { path: /mnt/disk3, diskbyid: /dev/disk/by-id/ata-WDC_WD100EMAZ-00WJTA0_2YJ15VJD-part1, fs: xfs, opts: defaults, content: true }
  # disk4 replaced nov 11th 2021 - 10tb to 12tb
  #- { path: /mnt/disk4, diskbyid: /dev/disk/by-id/ata-WDC_WD100EMAZ-00WJTA0_2YJ2S3AD-part1, fs: xfs, opts: defaults, content: false }
  - { path: /mnt/disk4, diskbyid: /dev/disk/by-id/ata-WDC_WD120EMAZ-11BLFA0_5PGENVSD-part1, fs: xfs, opts: defaults, content: false }
  - { path: /mnt/disk5, diskbyid: /dev/disk/by-id/ata-WDC_WD100EMAZ-00WJTA0_16G1016Z-part1, fs: xfs, opts: defaults, content: false }
  - { path: /mnt/disk6, diskbyid: /dev/disk/by-id/ata-WDC_WD120EDAZ-11F3RA0_5PJHZW1F-part1, fs: xfs, opts: defaults, content: false }
  - { path: /mnt/disk7, diskbyid: /dev/disk/by-id/ata-ST10000DM0004-2GR11L_ZJV5CF96-part1, fs: xfs, opts: defaults, content: false }

zfs_disks:
  # ata-ST10000DM0004-2GR11L_ZJV5CF96 ## failed june 2021
  # ata-ST10000NE0008-2JM101_ZPW0N45T ## installed june 2021
  # ata-WDC_WD100EMAZ-00WJTA0_2YJ7E2VD
  # zpool replace tank /dev/disk/by-id/ata-ST10000DM0004-2GR11L_ZJV5CF96 /dev/disk/by-id/ata-ST10000NE0008-2JM101_ZPW0N45T

  ## nvme zfs mirror
  # nvme-eui.00000000000000108ce38e02000e543f-part1 -> ../../nvme1n1p1
  # nvme-eui.00000000000000108ce38e02000e5450-part1 -> ../../nvme0n1p1


fstab_mergerfs:
  - { source: "/mnt/disk*:/mnt/tank/fuse", mountpoint: "/mnt/storage", fs: fuse.mergerfs, opts: "defaults,nonempty,allow_other,use_ino,moveonenospc=true,category.create=epmfs,dropcacheonclose=true,minfreespace=250G,fsname=mergerfs" }  
  - { source: "/mnt/disk*", mountpoint: "/mnt/jbod", fs: fuse.mergerfs, opts: "defaults,nonempty,allow_other,use_ino,moveonenospc=true,category.create=mspmfs,dropcacheonclose=true,minfreespace=250G,fsname=jbod" }  

snapraid_runner_email_address: "{{ gmail_address }}"
snapraid_runner_gmail_pass: "{{ snapraid_email_password }}"
snapraid_sync_healthcheck_io_uuid: "{{ snapraid_healthcheck_secret }}"

# ktz-traefik
traefik_file_provider: true
traefik_enable_dashboard: false #defaults to false
traefik_insecure_transport: false #defaults to false

## ktz-authelia
authelia_users:
  - username: "{{ authelia_username }}"
    displayname: "{{ authelia_displayname }}"
    # docker run authelia/authelia:latest authelia hash-password 'yourpassword'
    password: "{{ authelia_password }}"
    email: "{{ gmail_address }}"
    groups:
      - admin
      - dev
authelia_rules:
  - domain: "*.m.{{ local_domain }}"
    policy: bypass
    resources:
      - '^/api.*$'
  - domain: "*.m.{{ local_domain }}"
    policy: one_factor
  - domain: "plex.{{ domain_me }}"
    policy: one_factor
  - domain: "wiki.{{ domain_me }}"
    policy: one_factor
  - domain: "nc.{{ domain_cloud }}"
    policy: bypass


# ironicbadger.docker_compose_generator
appdata_path: /mnt/nvme2tb/appdata
download_path: /mnt/nvme2tb/downloads
storage_path: /mnt/storage
local_domain: "wd.{{ domain_me }}"

containers:
  ###
  - service_name: tr
    active: true
    image: traefik
    ports:
      - 80:80
      - 443:443
      - 8080:8080
    extra_hosts:
      - host.docker.internal:172.17.0.1
    environment:
      - "CLOUDFLARE_EMAIL={{ cloudflare_account_email }}"
      - "CLOUDFLARE_API_KEY={{ cloudflare_api_key }}"
    volumes:
      - "{{ appdata_path }}/traefik:/etc/traefik"
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
    restart: unless-stopped
  ###
  - service_name: authelia
    active: true
    image: authelia/authelia
    labels:
      - traefik.enable=true
      - "traefik.http.routers.authelia.rule=Host(`login.m.{{ local_domain }}`)"
      - traefik.http.routers.authelia.tls=true
      - traefik.http.services.authelia.loadbalancer.server.port=9091
      - "traefik.http.middlewares.authelia.forwardauth.address=http://authelia:9091/api/verify?rd=https://login.m.{{ local_domain }}/"
      - traefik.http.middlewares.authelia.forwardauth.trustForwardHeader=true
      - traefik.http.middlewares.authelia.forwardauth.authResponseHeaders=Remote-User,Remote-Groups,Remote-Name,Remote-Email
    volumes:
      - "{{ appdata_path }}/authelia:/config"
    expose:
    restart: unless-stopped
  - service_name: redis
    active: true
    image: redis
    restart: unless-stopped
  ###
  - service_name: flame
    active: true
    image: pawelmalak/flame
    labels:
      - traefik.enable=true
      - "traefik.http.routers.flame.rule=Host(`flame.m.{{ local_domain }}`)"
    environment:
      - "PASSWORD={{ main_pass_lower }}"
    volumes:
      - "{{ appdata_path }}/flame:/app/data"
      - /var/run/docker.sock:/var/run/docker.sock
    include_global_env_vars: true
    restart: unless-stopped
  ###
  - service_name: plex
    active: true
    image: plexinc/pms-docker
    network_mode: host
    devices:
      - /dev/dri:/dev/dri
    labels:
      - traefik.enable=true
      - "traefik.http.routers.plex.rule=Host(`plex.{{ domain_me }}`)"
      - traefik.http.services.plex.loadbalancer.server.port=32400
      - flame.type=app
      - flame.name=Plex
      - "flame.url=https://plex.{{ domain_me }}"
      - flame.icon=plex
    volumes:
      - "{{ appdata_path }}/plex/config:/config"
      - "{{ appdata_path }}/plex/transcode:/transcode"
      - "{{ morpheus_main_storage_path }}:/data"
    include_global_env_vars: true
    restart: unless-stopped
###
  - service_name: tautulli
    active: true
    image: linuxserver/tautulli
    depends_on:
      - plex
    labels:
      - traefik.enable=true
      - "traefik.http.routers.tautulli.rule=Host(`tautulli.m.{{ local_domain }}`)"
      - flame.type=app
      - flame.name=Tautulli
      - "flame.url=https://tautulli.m.{{ local_domain }}"
      - flame.icon=chart-areaspline
    volumes:
      - "{{ appdata_path }}/tautulli:/config"
      - "{{ appdata_path }}/plex/Library/Application Support/Plex Media Server/Logs:/logs:ro"
    include_global_env_vars: true
    restart: unless-stopped
  ###
  - service_name: nzbget
    active: true
    image: linuxserver/nzbget
    labels:
      - traefik.enable=true
      - "traefik.http.routers.nzbget.rule=Host(`nzbget.m.{{ local_domain }}`)"
      - traefik.http.routers.nzbget.middlewares=authelia@docker
      - "traefik.http.routers.nzbgetapi.rule=Host(`nzbgetapi.m.{{ local_domain }}`)"
      - flame.type=app
      - flame.name=NZBget
      - "flame.url=https://nzbget.m.{{ local_domain }}"
      - flame.icon=download
    volumes:
      - "{{ appdata_path }}/nzbget/config:/config"
      - "{{ download_path }}:/downloads"
    restart: unless-stopped
    include_global_env_vars: true
  ###
  - service_name: sonarr
    active: true
    image: linuxserver/sonarr
    depends_on:
      - nzbget
    labels:
      - traefik.enable=true
      - "traefik.http.routers.sonarr.rule=Host(`sonarr.m.{{ local_domain }}`)"
      - traefik.http.routers.sonarr.middlewares=authelia@docker
      - flame.type=app
      - flame.name=Sonarr
      - "flame.url=https://sonarr.m.{{ local_domain }}"
      - flame.icon=television-classic
    volumes:
      - "{{ appdata_path }}/sonarr:/config"
      - "{{ download_path }}/complete/tv:/downloads/complete/tv"
      - /mnt/jbod/tv:/tv
    restart: unless-stopped
    include_global_env_vars: true
  ###
  - service_name: radarr
    active: true
    image: linuxserver/radarr
    volumes:
      - "{{ appdata_path }}/radarr:/config"
      - "{{ download_path }}/complete/movies:/downloads/complete/movies"
      - /mnt/jbod/movies:/movies
    labels:
      - traefik.enable=true
      - "traefik.http.routers.radarr.rule=Host(`radarr.m.{{ local_domain }}`)"
      - traefik.http.routers.radarr.middlewares=authelia@docker
      - flame.type=app
      - flame.name=Radarr
      - "flame.url=https://radarr.m.{{ local_domain }}"
      - flame.icon=movie-open-outline
    restart: unless-stopped
    include_global_env_vars: true
  ###
  - service_name: lidarr
    active: true
    image: linuxserver/lidarr
    volumes:
      - "{{ appdata_path }}/lidarr:/config"
      - "{{ download_path }}/complete/music:/downloads/complete/music"
      - "{{ download_path }}/intermediate/music:/downloads-amd"
      - /mnt/storage/flac/flac:/music
    labels:
      - traefik.enable=true
      - "traefik.http.routers.lidarr.rule=Host(`lidarr.m.{{ local_domain }}`)"
      - traefik.http.routers.lidarr.middlewares=authelia@docker
      - flame.type=app
      - flame.name=Lidarr
      - "flame.url=https://lidarr.m.wd.{{ domain_me }}"
      - flame.icon=music-box-outline
    restart: unless-stopped
    include_global_env_vars: true
  ###
  - service_name: tiddlywiki
    active: true
    image: mazzolino/tiddlywiki
    labels:
      - traefik.enable=true
      - "traefik.http.routers.tiddlywiki.rule=Host(`wiki.{{ domain_me }}`)"
      - traefik.http.services.tiddlywiki.loadbalancer.server.port=8080
      - traefik.http.routers.tiddlywiki.middlewares=authelia@docker
      - flame.type=app
      - flame.name=Tiddlywiki
      - "flame.url=https://wiki.{{ domain_me }}"
      - flame.icon=book-information-variant
    environment:
      - USERNAME=
      - PASSWORD=
    volumes:
      - "{{ appdata_path }}/tiddlywiki:/var/lib/tiddlywiki"
    restart: unless-stopped
  ###
  - service_name: chowdown
    active: true
    image: gregyankovoy/chowdown
    labels:
      - traefik.enable=true
      - "traefik.http.routers.chowdown.rule=Host(`recipes.m.{{ local_domain }}`)"
      - flame.type=app
      - flame.name=Chowdown
      - "flame.url=https://recipes.m.wd.{{ domain_me }}"
      - flame.icon=carrot
    volumes:
      - "{{ appdata_path }}/chowdown/config:/config"
      - "{{ appdata_path }}/chowdown/recipes:/config/_recipes"
      - "{{ appdata_path }}/chowdown/posts:/config/_posts"
      - "{{ appdata_path }}/chowdown/images:/config/images"
    restart: unless-stopped
  ###
  - service_name: nextcloud
    active: true
    image: nextcloud:stable
    depends_on:
      - mysql
    labels:
      - traefik.enable=true
      - "traefik.http.routers.nc.rule=Host(`nc.{{ domain_cloud }}`)"
      - flame.type=app
      - flame.name=Nextcloud
      - "flame.url=https://nc.{{ domain_cloud }}"
      - flame.icon=cloud-upload-outline
    volumes:
      - "{{ appdata_path }}/nextcloud:/var/www/html"
    restart: unless-stopped
  ###
  - service_name: mysql
    active: true
    image: mariadb
    ports:
      - 3306:3306
    environment:
      - "MYSQL_ROOT_PASSWORD={{ container_mysql_root_password }}"
      - "MYSQL_PASSWORD={{ container_mysql_password }}"
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
    volumes:
      - "{{ appdata_path }}/mysql:/var/lib/mysql"
    restart: unless-stopped
  ###
  - service_name: smokeping
    active: true
    image: linuxserver/smokeping
    volumes:
      - "{{ appdata_path }}/smokeping/config:/config"
      - "{{ appdata_path }}/smokeping/data:/data"
    labels:
      - traefik.enable=true
      - "traefik.http.routers.smokeping.rule=Host(`smokeping.m.{{ local_domain }}`)"
      - flame.type=app
      - flame.name=Smokeping
      - "flame.url=https://smokeping.m.{{ local_domain }}/smokeping/smokeping.cgi"
      - flame.icon=smoke
    include_global_env_vars: true
    restart: unless-stopped
  ###
  - service_name: gitea
    active: true
    image: gitea/gitea
    depends_on:
      - mysql
    environment:
      - "USER_UID={{ main_uid }}"
      - "USER_GID={{ main_gid }}"
      - "ROOT_URL=https://git.ktz.me"
      - "SSH_DOMAIN=git.ktz.me"
      - "APP_NAME=git.ktz.me"
      - "SSH_PORT=2222"
      - "DISABLE_REGISTRATION=true"
      - "REQUIRE_SIGNIN_VIEW=true"
    volumes:
      - "{{ appdata_path }}/gitea:/data"
    labels:
      - traefik.enable=true
      - traefik.http.routers.git.rule=Host(`git.ktz.me`)
      - traefik.http.services.git.loadbalancer.server.port=3000
    ports:
      - '"2222:2222"'
    restart: unless-stopped
  ###
  - service_name: drone
    active: true
    image: drone/drone:latest
    volumes:
      - "{{ appdata_path }}/drone:/data"
    environment:
      - "DRONE_GITEA_SERVER=https://git.{{ domain_me }}/"
      - DRONE_GIT_ALWAYS_AUTH=true
      - "DRONE_GITEA_CLIENT_ID={{ drone_gitea_client_id }}"
      - "DRONE_GITEA_CLIENT_SECRET={{ drone_gitea_client_secret }}"
      - "DRONE_SERVER_HOST=drone.m.{{ local_domain }}"
      - DRONE_SERVER_PROTO=https
      - DRONE_RPC_SECRET=super-duper-secret
      - "DRONE_USER_CREATE=username:alexktz,admin:true"
    labels:
      - traefik.enable=true
      - "traefik.http.routers.drone.rule=Host(`drone.m.{{ local_domain }}`)"
    ports:
      - "3001:80"
    restart: unless-stopped
  - service_name: drone-runner-docker
    active: true
    image: drone/drone-runner-docker:1
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - DRONE_RPC_PROTO=https
      - "DRONE_RPC_HOST=drone.m.{{ local_domain }}"
      - DRONE_RPC_SECRET=super-duper-secret
      - DRONE_RUNNER_CAPACITY=2
      - "DRONE_RUNNER_NAME={{ hostname_morpheus }}"
    ports: 
      - 3002:3000
    depends_on:
      - drone
    restart: unless-stopped
  ###
  - service_name: sync
    active: true
    image: linuxserver/resilio-sync
    hostname: "{{ hostname_morpheus }}"
    volumes:
      - "{{ appdata_path }}/sync:/config"
      - "{{ morpheus_main_storage_path }}:/sync"
    labels:
      - traefik.enable=true
      - "traefik.http.routers.btsync.rule=Host(`sync.m.{{ local_domain }}`)"
    ports:
      - "55555:55555"
    include_global_env_vars: true
    restart: unless-stopped
  ###
  - service_name: librespeed
    active: true
    image: linuxserver/librespeed
    ports:
      - 8008:80
    labels:
      - traefik.enable=true
      - "traefik.http.routers.librespeed.rule=Host(`speed.m.{{ local_domain }}`)"
    environment:
      - MODE=standalone
      - TELEMETRY=true
      - "PASSWORD={{ librespeed_password }}"
    include_global_env_vars: true
    restart: unless-stopped
  ###
  - service_name: lychee
    active: true
    image: lycheeorg/lychee
    labels:
      - traefik.enable=true
      - "traefik.http.routers.lychee.rule=Host(`gallery.m.{{ local_domain }}`)"
      #- traefik.http.services.lychee.loadbalancer.server.port=80
    depends_on:
      - mysql
    volumes:
      - "{{ appdata_path }}/lychee/config:/config"
      - "{{ appdata_path }}/lychee/uploads:/uploads"
      - "{{ appdata_path }}/lychee/sym:/sym"
    environment:
      - PHP_TZ=America/New_York
      - DB_CONNECTION=mysql
      - DB_HOST=mysql
      - DB_PORT=3306
      - DB_USERNAME=lychee
      - DB_DATABASE=lychee
      - "DB_PASSWORD={{ container_mysql_password }}"
    include_global_env_vars: true
    restart: unless-stopped
  ###
  - service_name: ninja_nginx
    active: true
    image: nginx:mainline-alpine
    labels:
      - traefik.enable=true
      - "traefik.http.routers.nginx.rule=Host(`ninja.m.{{ local_domain }}`)"
    volumes:
      - "{{ appdata_path }}/invoiceninja/ninja.conf:/etc/nginx/conf.d/default.conf:ro"
      - "{{ appdata_path }}/invoiceninja/storage:/var/www/app/storage"
      - "{{ appdata_path }}/invoiceninja/public/logo:/var/www/app/logo"
      - "{{ appdata_path }}/invoiceninja/public:/var/www/app/public"
    restart: unless-stopped
  ###
  - service_name: invoiceninja
    active: true
    image: invoiceninja/invoiceninja:4.5.18
    depends_on:
      - mysql
    volumes:
      - "{{ appdata_path }}/invoiceninja/storage:/var/www/app/storage"
      - "{{ appdata_path }}/invoiceninja/public/logo:/var/www/app/logo"
      - "{{ appdata_path }}/invoiceninja/public:/var/www/app/public"
    environment:
      - MYSQL_DATABASE=ninja
      - "MYSQL_ROOT_PASSWORD={{ container_mysql_password}}"
      - APP_DEBUG=0
      - "APP_URL={{ invoice_ninja_app_url }}"
      - "APP_KEY={{ invoice_ninja_app_key }}"
      - APP_CIPHER=AES-256-CBC
      - DB_USERNAME=root
      - "DB_PASSWORD={{ container_mysql_password}}"
      - DB_HOST=mysql
      - DB_DATABASE=ninja
      - MAIL_HOST=smtp.gmail.com
      - "MAIL_USERNAME={{ gmail_address }}"
      - "MAIL_PASSWORD={{ invoice_ninja_gmail_app_password }}"
      - MAIL_DRIVER=smtp
      - MAIL_FROM_NAME="Alex K"
      - "MAIL_FROM_ADDRESS={{ gmail_address }}"
      - REQUIRE_HTTPS=true
      - "TRUSTED_PROXIES='*'"
    restart: unless-stopped
  ###
  - service_name: paperless
    active: true
    image: ghcr.io/paperless-ngx/paperless-ngx:latest
    labels:
      - traefik.enable=true
      - "traefik.http.routers.paperless.rule=Host(`paperless.m.{{ local_domain }}`)"
    volumes:
      - "{{ appdata_path }}/paperless/config:/config"
      - "{{ appdata_path }}/paperless/data:/data"
    environment:
      - PAPERLESS_CONSUMER_RECURSIVE=true
      - PAPERLESS_CONSUMER_SUBDIRS_AS_TAGS=true
    include_global_env_vars: true
    restart: unless-stopped
###
  - service_name: mealie
    active: true
    image: hkotel/mealie:v0.5.1
    labels:
      - traefik.enable=true
      - traefik.http.routers.mealie.rule=Host(`mealie.m.{{ local_domain }}`)
    environment:
      - DB_TYPE=sqlite
    volumes:
      - "{{ appdata_path }}/mealie:/app/data"
    restart: unless-stopped  
  ###
  - service_name: sui
    active: true
    image: griefed/sui
    labels:
      - traefik.enable=true
      - "traefik.http.routers.sui.rule=Host(`sui.m.{{ local_domain }}`)"
    volumes:
      - "{{ appdata_path }}/sui:/config"
    environment:
      - PROTOCOL=http
      - "DOMAIN=sui.m.{{ local_domain }}"
    include_global_env_vars: true
    restart: unless-stopped
  ###
  - service_name: prowlarr
    active: true
    image: linuxserver/prowlarr:develop
    labels:
      - traefik.enable=true
      - "traefik.http.routers.prowlarr.rule=Host(`prowlarr.m.{{ local_domain }}`)"
      - traefik.http.routers.prowlarr.middlewares=authelia@docker
    volumes:
      - "{{ appdata_path }}/prowlarr:/config"
    include_global_env_vars: true
    restart: unless-stopped
  ###
  - service_name: plexmeta
    active: true
    image: meisnate12/plex-meta-manager
    volumes:
      - "{{ appdata_path }}/plexmeta/config:/config"
    environment:
      - TZ=America/New_York
      - PMM_TIME=01:22
    restart: unless-stopped
  ###
  - service_name: plextraktsync
    active: false
    image: ghcr.io/taxel/plextraktsync
    volumes:
      - "{{ appdata_path }}/plextraktsync/config:/app/config"
    restart: unless-stopped
  ###
  - service_name: wellandwiki
    active: true
    image: nginx
    labels:
      - traefik.enable=true
      - "traefik.http.routers.wellandwiki.rule=Host(`wellandwiki.m.{{ local_domain }}`)"
    volumes:
      - "{{ appdata_path }}/wellandwiki/site:/usr/share/nginx/html:ro" 
    restart: unless-stopped
  ###
  - service_name: foundation
    active: true
    image: nginx
    labels:
      - traefik.enable=true
      - "traefik.http.routers.foundation.rule=Host(`foundation.m.{{ local_domain }}`)"
    volumes:
      - "{{ appdata_path }}/foundation/site:/usr/share/nginx/html:ro" 
    restart: unless-stopped
  ###
  - service_name: dozzle
    active: true
    image: amir20/dozzle
    labels:
      - traefik.enable=true
      - "traefik.http.routers.dozzle.rule=Host(`dozzle.m.{{ local_domain }}`)"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    restart: unless-stopped
  ###
  - service_name: jellyfin
    active: true
    image: jellyfin/jellyfin
    network_mode: host
    devices:
      - /dev/dri:/dev/dri
    labels:
      - traefik.enable=true
      - "traefik.http.routers.jellyfin.rule=Host(`jellyfin.m.{{ local_domain }}`)"
      - traefik.http.services.jellyfin.loadbalancer.server.port=8096
    volumes:
      - "{{ appdata_path }}/jellyfin:/config"
      - "{{ morpheus_main_storage_path }}:/data"
    environment:
      - "JELLYFIN_PublishedServerUrl=jellyfin.m.{{ local_domain }}"
    include_global_env_vars: true
    restart: unless-stopped
  ###
  - service_name: changedetect
    active: true
    image: dgtlmoon/changedetection.io
    labels:
      - traefik.enable=true
      - "traefik.http.routers.change.rule=Host(`change.m.{{ local_domain }}`)"
      - traefik.http.services.change.loadbalancer.server.port=5000
    volumes:
      - "{{ appdata_path }}/changedetect:/datastore"
    restart: unless-stopped
  ###
  - service_name: abs
    active: true
    image: advplyr/audiobookshelf
    labels:
      - traefik.enable=true
      - "traefik.http.routers.audiobookshelf.rule=Host(`abs.m.{{ local_domain }}`)"
    volumes:
      - "{{ morpheus_main_storage_path }}/audiobooks/library:/audiobooks"
      - "{{ appdata_path }}/audiobookshelf/metadata:/metadata"
      - "{{ appdata_path }}/audiobookshelf/config:/config"
    restart: unless-stopped

  # template for docker-compose services
  #
  ###
  # - service_name:
  #   active: false
  #   image:
  #   container_name: #optional - only required if diff to service_name
  #   labels:
  #     - traefik.enable=true
  #     - "traefik.http.routers.XXXXXXXX.rule=Host(`abs.m.{{ local_domain }}`)"
  #     #- traefik.http.routers.XXXXXXX.entrypoints=websecure
  #     #- traefik.http.routers.XXXXXXX.tls.certresolver=cloudflare
  #     - traefik.http.services.XXXXXXX.loadbalancer.server.port=80
  #     #- traefik.http.routers.XXXXXXX.middlewares=authelia@docker
  #   volumes:
  #     - "{{ appdata_path }}/app:/config"
  #   environment:
  #     -
  #   include_global_env_vars: #optional - defaults to false
  #   restart: unless-stopped
